### GPT名称：LawTask API Integration Assistant
[访问链接](https://chat.openai.com/g/g-BH4kJfxNP)
## 简介：帮助进行LawTask CRM API集成
![头像](../imgs/g-BH4kJfxNP.png)
```text
1. Настройка Tilda для API LawTask ArtemNovember 17, 2023 Базовая инструкция представлена по этой ссылке. В тексте далее лишь специфика для Tilda. Тильда — конструктор сайтов. Рассмотрим несколько альтернативных способов отправки лида из формы Tilda в API LawTask. Используйте тот, что больше нравится. Способ "напрямую" API LawTask совместим с Tilda. Можно напрямую отправить данные из штатной формы Tilda в API LawTask по инструкции Tilda: Нажмите: Настройки сайта → Формы → Webhook. Укажите адрес из документации. Сохраните. Перейдите на страницу и в меню «Контент» блока с формой отметьте сервис приема данных — Webhook. Сохраните и опубликуйте страницу. Однако, потребуется настроить форму так, чтобы она содержала все обязательные параметры для API. Подробнее в разделе настройки формы. И такой способ, вероятно, не подойдет для нестандартных форм Tilda. В целом, это лучший вариант, потому что он не требует добавления в цепочку действий дополнительных звеньев вроде JavaScript или серверной обработки. Способ через Webhook Webhook — скрипт на серверном языке, который будет ловить данные из заполненной формы и отправлять их в API LawTask. Он нужен в как посредник при пересылке если "вилку" Tilda не удаётся совместить с "розеткой" LawTask API напрямую. Т.е. это что-то вроде переходника. И, разумеется, можно добавить ещё какую-то логику вроде валидации, логгирования ошибок и т.п. Пример кода с готовым вебхуком доступен в GitHub. В нём уже предусмотрена возможность добавить в передаваемые данные технические параметры вроде integration_id, захардкодить город лида и гарантированное передать не пустую строку в параметре situation. Вам потребуется сервер или какой-то хостинг для того, чтобы разместить webhook. При необходимости, мы можем сами подготовить нужный скрипт и запустить его на своих серверах. Вам останется подтвердить его и настроить форму так, чтобы данные из неё попадали в вебхук. Инструкция по подключению вебхука к форме есть в самой Tilda. Если будете писать вебхук самостоятельно, обратите внимание, что в этой инструкции представлен базовый пример webhook для последующей отправки лида почтой. Нам же нужен экспорт напрямую в API LawTask, а не на почту. Добавление вебхука-посредника для проксирования данных не лучший вариант: мы добавляем в цепочку ещё одно звено, что уменьшает общую надёжности системы. Например, если сервер с вебхуком на тех. обслуживании, то лид не будет передан. Способ через JavaScript Альтернативный способ добиться того же самого есть и через JavaScript без всякой северной обработки. Требуется пройти всего несколько шагов: Шаг 1: добавление скрипта Достаточно добавить пустой блок (например, блок T123 по Тильде) и просто вставить туда уже готовый JS-код. Обратите внимание, что код надо вставлять вот так в пустой блок:

2. <script> вот тут код </script> Этот код навешивает на форму дополнительную логику: если форма заполнена успешно, то он отправит лида в API LawTask. Код работает для любых штатных форм Tilda в любом количестве на странице. Если оставить так, то форма будет работать как и раньше (сохранится валидация и всё прочее от Tilda). Однако, обратите внимание, что он ищет формы по классу .js-form-proccess. Такой способ поиска форм представлен в самой документации Tilda, но работает только для их штатных форм. Если у вас своя самописная форма, то, вероятно, лучше адаптировать вот этот код (он более универсален, но заменит собой логику отправки формы). Шаг 2: настройка формы Откройте редактор страницы в Tilda и выберите форму, с которой вы работаете. Перейдите к настройкам каждого поля в форме. В разделе настроек поля найдите поле для установки атрибута name. Это обычно находится в настройках конкретного поля формы. Укажите соответствующие имена: установите имя для каждого поля в соответствии с требованиями API по инструкции. Например, для поля ввода телефона установите name='phone'. Цель этого шага в том, чтобы при отправке формы, передавались все необходимые пары ключ-значение. Это важно. Например, если номер телефона лида у вас содержится в поле с атрибутом name = tel, то такой лид не будет принят, ведь API, куда попадут данные, будет проверять именно параметр phone, а не tel. Получится что-то вроде вот такого: tel = 1234567890 phone = '' И поскольку phone ничего не содержит, то API посчитает что отправлен лид без номера телефона и не примет его. А в поле tel даже не заглянет. Поэтому, обращайте внимание, чтобы атрибут name у полей полностью соответствовали хотя бы обязательным параметрам API. Регистр имеет значение, например: Phone — неверно, правильно: phone. Недостающие обязательные параметры нужно добавить в форму. Integration_id — фиксированный технический параметр. Его лучше скрыть от пользователя, чтобы не смущать его непонятным полем в форме. Для того, чтобы сделать поле скрытым от пользователя: • Добавьте новое поле. • Выберите тип поля как "Скрытое" (Hidden). • Установите атрибут name как integration_id. • Введите фиксированное значение для этого поля, которое будет отправляться вместе с формой (ID интеграции, который вы получили вместе с инструкцией). Если вы владеете JavaScript, то разумеется, можете просто добавить недостающие параметры прямо в скрипте: formData.append('integration_id', 12345); // замените на ваш Шаг 3: проверка Самый простой способ проверить всё ли в порядке — консоль. В браузере Chrome откройте вкладку разработчика (F12 на windows) и перейдите в раздел "консоль". В ней вы увидите что происходит когда отправляется форма с лидом. Если возникнет ошибка — вы увидите её в череде сообщений в консоли.

3. Заголовки запросов LawTask API При отправке лида POST методом может возникнуть вопрос: какой заголовок указывать. Лучше всего, указывать заголовок Content-Type: application/x-www-form-urlencoded. Однако, LawTask API пытается принять данные всеми возможными способами, поэтому валидными являются как заголовок: Content-Type: application/x-www-form-urlencoded (отправка формы), так и Content-Type: application/json (обычный JSON объект) или даже отсутствие заголовка. Так, все представленные ниже способы валидны: Подходит и json

4. curl -X POST http://localhost:8000/API/api.php -H "Content-Type: application/json" -d '{"test": true, "situation": "Test", "phone": "12345", "integration_id": 1234, "city": "City"}' и form-urlencoded

5. curl -X POST http://localhost:8000/API/api.php -H "Content-Type: application/x-www-form-urlencoded" -d "test=true&situation=Test&phone=12345&integration_id=1234&city=City" и даже отсутствие заголовка

6. curl -X POST http://localhost:8000/API/api.php -d "test=true&situation=Test&phone=12345&integration_id=1234&city=City" или так:

7. curl -X POST http://localhost:8000/API/api.php -d '{"test": true, "situation": "Test", "phone": "12345", "integration_id": 1234, "city": "City"}' Подробнее о заголовках см. документацию MDN. Подробнее о тестах и запросах смотрите основной раздел документации.

8. Инструкция о том, как передавать лиды напрямую в API LawTask CRM. Инструкция предназначена для разных целевых аудиторий. Вы наверняка сможете разобраться без специальных знаний в предметной области. Если у вас есть техники, передайте её им вместе с идентификационным номером. Искусственный интеллект GPT последней версии был дообучен на этой документации чтобы стать эффективным помощником в настройке. Вы можете использовать ассистента для помощи в настройке. Адрес приёма лидов Наш адрес для получения лидов:

9. https://lawtask.pro/API/api.php Передавать данные необходимо POST методом. Желательно указывать заголовок Content-Type: application/x-www-form-urlencoded и использовать HTTPS протокол. Подробнее о заголовках. В теле запроса необходимо передать объект с параметрами лида и технической информацией.

10. Обязательные поля { integration_id: integer, city: string, phone: integer | string, situation: string } integration_id — ID этой интеграции. Этот ID мы создаём на своей стороны и передаём поставщику лидов. Если у вас нет этого ID - запросите его у нас. Это важный параметр, по нему мы определяем отправителя, конечного получателя и прочее. Максимум, 30 символов. Целочисленное. Например, 12345

11. city — город лида. В большинстве случаев, можно передать любую строку, потому что город мы определим исходя из ID интеграции. Но иногда это невозможно. Для н
```